-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- Settings
local floatHeightOffset = 12
local floatSpeed = 16
local teleportDistance = 7

local floating = false
local hrp = nil
local humanoid = nil

local bodyPos = nil
local bodyVel = nil

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "StealABrainrotGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 380, 0, 260)
frame.Position = UDim2.new(0.5, -190, 0.4, -130)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = ScreenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "Steal a Brainrot Helper"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.Parent = frame

local tabsFrame = Instance.new("Frame")
tabsFrame.Size = UDim2.new(1, 0, 0, 30)
tabsFrame.Position = UDim2.new(0, 0, 0, 30)
tabsFrame.BackgroundTransparency = 1
tabsFrame.Parent = frame

local tabs = {"Main", "Visual", "Misc"}
local tabButtons = {}
local pages = {}

local function createTabButton(name, pos)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 120, 1, 0)
    btn.Position = UDim2.new(0, pos, 0, 0)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 18
    btn.Parent = tabsFrame
    return btn
end

local function createPage()
    local page = Instance.new("Frame")
    page.Size = UDim2.new(1, 0, 1, -60)
    page.Position = UDim2.new(0, 0, 0, 60)
    page.BackgroundTransparency = 1
    page.Visible = false
    page.Parent = frame
    return page
end

for i, name in ipairs(tabs) do
    local btn = createTabButton(name, (i-1)*120)
    tabButtons[name] = btn
    pages[name] = createPage()
end

local function switchTab(tabName)
    for name, page in pairs(pages) do
        page.Visible = (name == tabName)
        tabButtons[name].BackgroundColor3 = (name == tabName) and Color3.fromRGB(70, 70, 70) or Color3.fromRGB(45,45,45)
    end
end
switchTab("Main")

for name, btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function()
        switchTab(name)
    end)
end

-- Main Tab UI
local mainPage = pages["Main"]

local floatToggle = Instance.new("TextButton")
floatToggle.Size = UDim2.new(0, 180, 0, 40)
floatToggle.Position = UDim2.new(0.5, -90, 0, 20)
floatToggle.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
floatToggle.TextColor3 = Color3.new(1,1,1)
floatToggle.Font = Enum.Font.GothamBold
floatToggle.TextSize = 20
floatToggle.Text = "Toggle Float (Q)"
floatToggle.Parent = mainPage

local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0, 100, 0, 30)
speedLabel.Position = UDim2.new(0, 40, 0, 80)
speedLabel.BackgroundTransparency = 1
speedLabel.TextColor3 = Color3.new(1,1,1)
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextSize = 18
speedLabel.Text = "Speed:"
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = mainPage

local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(0, 100, 0, 30)
speedBox.Position = UDim2.new(0, 140, 0, 80)
speedBox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
speedBox.TextColor3 = Color3.new(1,1,1)
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 18
speedBox.Text = tostring(floatSpeed)
speedBox.ClearTextOnFocus = false
speedBox.Parent = mainPage

speedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local val = tonumber(speedBox.Text)
        if val and val > 0 and val <= 100 then
            floatSpeed = val
            speedBox.Text = tostring(floatSpeed)
        else
            speedBox.Text = tostring(floatSpeed)
        end
    end
end)

-- Visual Tab UI
local visualPage = pages["Visual"]

local espToggle = Instance.new("TextButton")
espToggle.Size = UDim2.new(0, 180, 0, 40)
espToggle.Position = UDim2.new(0.5, -90, 0, 20)
espToggle.BackgroundColor3 = Color3.fromRGB(65, 65, 65)
espToggle.TextColor3 = Color3.new(1,1,1)
espToggle.Font = Enum.Font.GothamBold
espToggle.TextSize = 20
espToggle.Text = "Toggle ESP"
espToggle.Parent = visualPage

local espEnabled = false
local espBoxes = {}

local function createESPForPlayer(plr)
    if espBoxes[plr] then return end
    local box = Drawing.new("Square")
    box.Color = Color3.fromRGB(0,255,0)
    box.Thickness = 2
    box.Filled = false
    box.Visible = false

    local name = Drawing.new("Text")
    name.Text = plr.Name
    name.Color = Color3.fromRGB(0,255,0)
    name.Size = 14
    name.Center = true
    name.Outline = true
    name.Visible = false

    espBoxes[plr] = {box = box, name = name}
end

local function removeESPForPlayer(plr)
    if espBoxes[plr] then
        espBoxes[plr].box:Remove()
        espBoxes[plr].name:Remove()
        espBoxes[plr] = nil
    end
end

local function updateESP()
    if not espEnabled then
        for _, data in pairs(espBoxes) do
            data.box.Visible = false
            data.name.Visible = false
        end
        return
    end

    local cam = workspace.CurrentCamera
    for plr, data in pairs(espBoxes) do
        if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and plr ~= player then
            local hrp = plr.Character.HumanoidRootPart
            local pos, onScreen = cam:WorldToViewportPoint(hrp.Position)
            if onScreen then
                local size = math.clamp(300 / pos.Z, 20, 100)
                data.box.Size = Vector2.new(size, size * 1.5)
                data.box.Position = Vector2.new(pos.X - size/2, pos.Y - size*0.75)
                data.box.Visible = true

                data.name.Position = Vector2.new(pos.X, pos.Y - size)
                data.name.Visible = true
            else
                data.box.Visible = false
                data.name.Visible = false
            end
        else
            data.box.Visible = false
            data.name.Visible = false
        end
    end
end

espToggle.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player then
                createESPForPlayer(plr)
            end
        end
    else
        for plr, _ in pairs(espBoxes) do
            removeESPForPlayer(plr)
        end
    end
end)

Players.PlayerAdded:Connect(function(plr)
    if espEnabled then
        createESPForPlayer(plr)
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    removeESPForPlayer(plr)
end)

RunService.RenderStepped:Connect(updateESP)

-- Misc Tab UI
local miscPage = pages["Misc"]

local teleportLabel = Instance.new("TextLabel")
teleportLabel.Size = UDim2.new(1, 0, 0, 40)
teleportLabel.Position = UDim2.new(0, 0, 0, 20)
teleportLabel.BackgroundTransparency = 1
teleportLabel.TextColor3 = Color3.new(1,1,1)
teleportLabel.Font = Enum.Font.Gotham
teleportLabel.TextSize = 18
teleportLabel.Text = "Press T to teleport 7 studs forward"
teleportLabel.Parent = miscPage

-- Floating functions
local function startFloating()
    if floating then return end
    if not player.Character then return end
    hrp = player.Character:FindFirstChild("HumanoidRootPart")
    humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if not hrp or not humanoid then return end

    humanoid.PlatformStand = true

    -- Teleport up instantly by 12 studs
    local currentPos = hrp.Position
    local targetPos = Vector3.new(currentPos.X, currentPos.Y + floatHeightOffset, currentPos.Z)
    hrp.CFrame = CFrame.new(targetPos)

    -- Lock vertical position exactly at new height
    bodyPos = Instance.new("BodyPosition")
    bodyPos.Name = "FloatBodyPosition"
    bodyPos.MaxForce = Vector3.new(0, 1e5, 0) -- vertical only
    bodyPos.P = 1e4
    bodyPos.D = 1e3
    bodyPos.Position = targetPos
    bodyPos.Parent = hrp

    -- Horizontal movement
    bodyVel = Instance.new("BodyVelocity")
    bodyVel.Name = "FloatBodyVelocity"
    bodyVel.MaxForce = Vector3.new(1e5, 0, 1e5) -- horizontal only
    bodyVel.P = 1e4
    bodyVel.Velocity = Vector3.new(0, 0, 0)
    bodyVel.Parent = hrp

    floating = true
end

local function stopFloating()
    if not floating then return end
    floating = false

    if bodyPos and bodyPos.Parent then
        bodyPos:Destroy()
    end
    if bodyVel and bodyVel.Parent then
        bodyVel:Destroy()
    end
    if humanoid then
        humanoid.PlatformStand = false
    end
end

RunService.Heartbeat:Connect(function()
    if floating and hrp and bodyPos and bodyVel then
        -- Keep Y locked to the float height (simulate platform)
        bodyPos.Position = Vector3.new(hrp.Position.X, bodyPos.Position.Y, hrp.Position.Z)

        -- Camera relative horizontal movement
        local camCF = camera.CFrame
        local forward = camCF.LookVector
        local right = camCF.RightVector

        local moveVec = Vector3.new()
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveVec += forward end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveVec -= forward end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveVec -= right end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveVec += right end

        moveVec = Vector3.new(moveVec.X, 0, moveVec.Z)
        if moveVec.Magnitude > 0 then
            moveVec = moveVec.Unit * floatSpeed
        end

        bodyVel.Velocity = Vector3.new(moveVec.X, 0, moveVec.Z)
    elseif bodyVel and bodyVel.Parent then
        bodyVel.Velocity = Vector3.new(0, 0, 0)
    end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end

    if input.KeyCode == Enum.KeyCode.Q then
        if floating then
            stopFloating()
        else
            startFloating()
        end
    elseif input.KeyCode == Enum.KeyCode.T then
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local forwardVector = hrp.CFrame.LookVector
            local targetPos = hrp.Position + forwardVector * teleportDistance
            local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            local tween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(targetPos)})
            tween:Play()
        end
    end
end)

floatToggle.MouseButton1Click:Connect(function()
    if floating then
        stopFloating()
    else
        startFloating()
    end
end)

print("Steal a Brainrot Helper loaded! Use Q to toggle float, T to teleport forward, toggle ESP in Visual tab.")
